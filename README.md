# VkusVill Telegram Bot

Telegram-ะฑะพั ะดะปั ัะฑะพัะฐ ะฟัะพะดัะบัะพะฒัั ะบะพัะทะธะฝ ะะบััะะธะปะป ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ AI.

![Demo](assets/pic.jpg)

## ะงัะพ ะดะตะปะฐะตั ะฑะพั

- ะัะธะฝะธะผะฐะตั ะทะฐะฟัะพัั ะฝะฐ ัะฑะพั ะฟัะพะดัะบัะพะฒ (ะฝะฐะฟัะธะผะตั, "ะกะพะฑะตัะธ ะบะพัะทะธะฝั ะดะปั ัะฐะปะฐัะฐ ะพะปะธะฒัะต")
- **ะะพะดะดะตัะถะธะฒะฐะตั ะณะพะปะพัะพะฒัะต ัะพะพะฑัะตะฝะธั** โ ััะฐะฝัะบัะธะฑะฐัะธั ัะตัะตะท Whisper API
- ะัะฟะพะปัะทัะตั Claude AI ะดะปั ะฟะพะฝะธะผะฐะฝะธั ัะตัะตะฟัะพะฒ ะธ ะฟะพะดะฑะพัะฐ ะธะฝะณัะตะดะธะตะฝัะพะฒ
- ะัะตั ัะพะฒะฐัั ัะตัะตะท MCP (Model Context Protocol) ะะบััะะธะปะป
- ะคะพัะผะธััะตั ะบะพัะทะธะฝั ะธ ะณะตะฝะตัะธััะตั ัััะปะบั ะดะปั ะพัะพัะผะปะตะฝะธั ะทะฐะบะฐะทะฐ

## ะกัะตะบ

- **OpenAI Agents SDK** โ ะฐะณะตะฝััะบะธะน ััะตะนะผะฒะพัะบ ั ะฟะพะดะดะตัะถะบะพะน MCP
- **LiteLLM** โ ะฟัะพะบัะธ ะดะปั ัะฐะฑะพัั ั ัะฐะทะฝัะผะธ LLM ัะตัะตะท OpenAI-ัะพะฒะผะตััะธะผัะน ะธะฝัะตััะตะนั
- **aiogram** โ ะฐัะธะฝััะพะฝะฝัะน Telegram Bot API
- **Claude Haiku 4.5** โ ัะทัะบะพะฒะฐั ะผะพะดะตะปั
- **Docker** โ ะบะพะฝัะตะนะฝะตัะธะทะฐัะธั

## ะฃััะฐะฝะพะฒะบะฐ ะธ ะทะฐะฟััะบ

### 1. ะะปะพะฝะธัะพะฒะฐัั ัะตะฟะพะทะธัะพัะธะน

```bash
git clone https://github.com/maddness/vkusvill-mcp-bot.git
cd vkusvill-mcp-bot
```

### 2. ะะฐัััะพะธัั ะบะพะฝัะธะณััะฐัะธั

**ะกะพะทะดะฐัั ัะฐะนะป `config.yaml`:**

```bash
cp config.example.yaml config.yaml
nano config.yaml  # ะธะปะธ ะปัะฑะพะน ะดััะณะพะน ัะตะดะฐะบัะพั
```

**ะะฐะฟะพะปะฝะธัั ัะพะบะตะฝั ะธ ะฝะฐัััะพะนะบะธ:**

```yaml
telegram:
  bot_token: "YOUR_BOT_TOKEN"  # ะขะพะบะตะฝ ะพั @BotFather
  admin_ids:
    - 123456789  # ะะฐั Telegram ID ะดะปั ัะฒะตะดะพะผะปะตะฝะธะน

llm:
  model: "litellm/openai/claude-haiku-4-5"
  api_key: "YOUR_API_KEY"  # API ะบะปัั ะดะปั Claude
  api_base: "YOUR_API_BASE_URL"  # URL ะฒะฐัะตะณะพ LLM API

mcp:
  url: "https://mcp001.vkusvill.ru/mcp"

whisper:
  api_url: "YOUR_WHISPER_API_URL"  # URL Whisper API ะดะปั ััะฐะฝัะบัะธะฑะฐัะธะธ
  api_key: "YOUR_WHISPER_API_KEY"  # API ะบะปัั (ะตัะปะธ ััะตะฑัะตััั)
  model: "whisper-1"
  max_file_size_mb: 20  # ะะฐะบัะธะผะฐะปัะฝัะน ัะฐะทะผะตั ะณะพะปะพัะพะฒะพะณะพ ัะพะพะฑัะตะฝะธั
  max_duration_seconds: 180  # ะะฐะบัะธะผะฐะปัะฝะฐั ะดะปะธัะตะปัะฝะพััั (3 ะผะธะฝััั)

bot:
  max_history_messages: 20
  stream_update_interval: 1.0
  stream_min_chars: 50
```

**ะะดะต ะฒะทััั ัะพะบะตะฝั:**
- `bot_token` โ ัะพะทะดะฐะนัะต ะฑะพัะฐ ัะตัะตะท [@BotFather](https://t.me/BotFather) ะฒ Telegram
- `api_key` โ ะฟะพะปััะธัะต API ะบะปัั ะดะปั Claude ะธะปะธ ัะพะฒะผะตััะธะผะพะณะพ ัะตัะฒะธัะฐ
- `admin_ids` โ ะฒะฐั Telegram ID (ัะทะฝะฐัั ะผะพะถะฝะพ ัะตัะตะท [@userinfobot](https://t.me/userinfobot))

### 3. ะะฐะฟััะบ ัะตัะตะท Docker (ัะตะบะพะผะตะฝะดัะตััั)

**ะกะพะฑัะฐัั ะธ ะทะฐะฟัััะธัั ะบะพะฝัะตะนะฝะตั:**

```bash
docker compose up -d --build
```

**ะะพัะผะพััะตัั ะปะพะณะธ:**

```bash
docker compose logs -f
```

**ะััะฐะฝะพะฒะธัั ะฑะพัะฐ:**

```bash
docker compose down
```

**ะะตัะตะทะฐะฟัััะธัั ะฑะพัะฐ:**

```bash
docker compose restart
```

### 4. ะะปะธ ะทะฐะฟััะบ ะปะพะบะฐะปัะฝะพ

```bash
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
python app.py
```

## ะะตะฟะปะพะน ะฝะฐ ัะตัะฒะตั

### ะขัะตะฑะพะฒะฐะฝะธั ะบ ัะตัะตะฒะพะผั ะดะพัััะฟั

ะกะตัะฒะตั ะดะพะปะถะตะฝ ะธะผะตัั ะธััะพะดััะธะน ะดะพัััะฟ ะบ ัะปะตะดัััะธะผ ัะตััััะฐะผ:

| ะะตัััั | ะะพัั | ะะฐะทะฝะฐัะตะฝะธะต |
|--------|------|------------|
| `github.com` | 443 | ะะปะพะฝะธัะพะฒะฐะฝะธะต ัะตะฟะพะทะธัะพัะธั |
| `pypi.org`, `files.pythonhosted.org` | 443 | ะฃััะฐะฝะพะฒะบะฐ Python-ะฟะฐะบะตัะพะฒ |
| `api.telegram.org` | 443 | Telegram Bot API |
| `mcp001.vkusvill.ru` | 443 | MCP ัะตัะฒะตั ะะบััะะธะปะป |
| ะะฐั LLM API | 443 | API ะดะปั ัะทัะบะพะฒะพะน ะผะพะดะตะปะธ |

### 1. ะะพะดะบะปััะธัััั ะบ ัะตัะฒะตัั
```bash
ssh user@your-server-ip
```

### 2. ะฃััะฐะฝะพะฒะธัั Docker
```bash
sudo apt update
sudo apt install docker.io docker-compose-v2 -y
sudo usermod -aG docker $USER
# ะะตัะตะปะพะณะธะฝะธัััั ะดะปั ะฟัะธะผะตะฝะตะฝะธั ะฟัะฐะฒ
```

### 3. ะะปะพะฝะธัะพะฒะฐัั ัะตะฟะพะทะธัะพัะธะน
```bash
git clone https://github.com/maddness/vkusvill-mcp-bot.git
cd vkusvill-mcp-bot
```

### 4. ะะฐัััะพะธัั ะบะพะฝัะธะณััะฐัะธั
```bash
cp config.example.yaml config.yaml
nano config.yaml  # ะฒััะฐะฒะธัั ัะพะบะตะฝั (ัะผ. ัะฐะทะดะตะป "ะะฐัััะพะธัั ะบะพะฝัะธะณััะฐัะธั")
```

### 5. ะะฐะฟัััะธัั ะฑะพัะฐ
```bash
docker compose up -d --build
```

### 6. ะฃะฟัะฐะฒะปะตะฝะธะต ะฑะพัะพะผ

**ะัะพัะผะพัั ะปะพะณะพะฒ:**
```bash
# ะะพัะปะตะดะฝะธะต 50 ัััะพะบ
docker compose logs --tail=50

# ะกะปะตะดะธัั ะทะฐ ะปะพะณะฐะผะธ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
docker compose logs -f
```

**ะะตัะตะทะฐะฟััะบ ะฑะพัะฐ:**
```bash
docker compose restart
```

**ะััะฐะฝะพะฒะบะฐ ะฑะพัะฐ:**
```bash
docker compose down
```

**ะะฑะฝะพะฒะปะตะฝะธะต ะบะพะดะฐ:**
```bash
git pull
docker compose up -d --build
```

**ะัะพัะผะพัั ะปะพะณะพะฒ ะฒะทะฐะธะผะพะดะตะนััะฒะธะน:**
```bash
# ะกัััะบัััะฐ: logs/YYYY-MM-DD/user_id/timestamp.json
ls -la logs/
cat logs/2026-01-03/123456789/2026-01-03_14-30-15.json | jq .
```

**ะัะพัะผะพัั ะฑะฐะทั ะดะฐะฝะฝัั ะฟะพะปัะทะพะฒะฐัะตะปะตะน:**
```bash
cat db/users.json | jq .
cat db/interactions.json | jq .
```

## ะะพะทะผะพะถะฝะพััะธ ะฑะพัะฐ

### ๐ค ะะพะปะพัะพะฒัะต ัะพะพะฑัะตะฝะธั

ะะพั ะฟะพะดะดะตัะถะธะฒะฐะตั ััะฐะฝัะบัะธะฑะฐัะธั ะณะพะปะพัะพะฒัั ัะพะพะฑัะตะฝะธะน ัะตัะตะท Whisper API:
- **ะะฐะบัะธะผะฐะปัะฝัะน ัะฐะทะผะตั:** 20 MB
- **ะะฐะบัะธะผะฐะปัะฝะฐั ะดะปะธัะตะปัะฝะพััั:** 3 ะผะธะฝััั (180 ัะตะบัะฝะด)
- **ะฏะทัะบ:** ะัััะบะธะน (ะฝะฐัััะฐะธะฒะฐะตััั)

ะัะพััะพ ะพัะฟัะฐะฒััะต ะณะพะปะพัะพะฒะพะต ัะพะพะฑัะตะฝะธะต ั ะทะฐะฟัะพัะพะผ, ะฝะฐะฟัะธะผะตั:
> "ะกะพะฑะตัะธ ะบะพัะทะธะฝั ะดะปั ะฑะพััะฐ"

ะะพั ะฐะฒัะพะผะฐัะธัะตัะบะธ:
1. ะะฐัะฟะพะทะฝะฐะตั ัะตัั
2. ะะพะบะฐะถะตั ัะฐัะฟะพะทะฝะฐะฝะฝัะน ัะตะบัั
3. ะะฑัะฐะฑะพัะฐะตั ะทะฐะฟัะพั ะธ ัะพะฑะตัะตั ะบะพัะทะธะฝั

### ๐ ะขะตะบััะพะฒัะต ัะพะพะฑัะตะฝะธั

ะัะฟัะฐะฒะปัะนัะต ะพะฑััะฝัะต ัะตะบััะพะฒัะต ัะพะพะฑัะตะฝะธั:
- "ะกะพะฑะตัะธ ะบะพัะทะธะฝั ะดะปั ัะฐะปะฐัะฐ ะพะปะธะฒัะต"
- "ะัะถะฝั ะฟัะพะดัะบัั ะดะปั ะฟะฐััั ะบะฐัะฑะพะฝะฐัะฐ"
- "ะฅะพัั ะฟัะธะณะพัะพะฒะธัั ะฑะพัั ะฝะฐ 4 ัะตะปะพะฒะตะบะฐ"

### ๐ ะกััะธะผะธะฝะณ ะพัะฒะตัะพะฒ

ะะพั ะธัะฟะพะปัะทัะตั ัััะธะผะธะฝะณ ะดะปั ะพัะพะฑัะฐะถะตะฝะธั ะพัะฒะตัะพะฒ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ:
- ะะธะดะธัะต ะฟัะพัะตัั ะพะฑัะฐะฑะพัะบะธ ะทะฐะฟัะพัะฐ
- ะัะฒะตั ะฟะพัะฒะปัะตััั ะฟะพััะตะฟะตะฝะฝะพ ะฟะพ ะผะตัะต ะณะตะฝะตัะฐัะธะธ
- ะะธะฝะธะผะฐะปัะฝะฐั ะทะฐะดะตัะถะบะฐ ะผะตะถะดั ะพะฑะฝะพะฒะปะตะฝะธัะผะธ

## ะะพะผะฐะฝะดั ะฑะพัะฐ

| ะะพะผะฐะฝะดะฐ | ะะฟะธัะฐะฝะธะต |
|---------|----------|
| `/start` | ะะฐัะฐัั ัะฐะฑะพัั ั ะฑะพัะพะผ |
| `/new_chat` | ะกะฑัะพัะธัั ะบะพะฝัะตะบัั ะธ ะฝะฐัะฐัั ะทะฐะฝะพะฒะพ |

## ะัะฟะพะปัะทะพะฒะฐะฝะธะต

1. ะัะฟัะฐะฒััะต ะฑะพัั ัะพะพะฑัะตะฝะธะต ั ะพะฟะธัะฐะฝะธะตะผ ัะพะณะพ, ััะพ ัะพัะธัะต ะฟัะธะณะพัะพะฒะธัั
2. ะะพั ะฝะฐะนะดัั ะฝัะถะฝัะต ะฟัะพะดัะบัั ะฒะพ ะะบััะะธะปะป
3. ะะพะปััะธัะต ะณะพัะพะฒัั ะบะพัะทะธะฝั ัะพ ัััะปะบะพะน ะฝะฐ ะพัะพัะผะปะตะฝะธะต ะทะฐะบะฐะทะฐ
4. ะะฐะถะผะธัะต ะบะฝะพะฟะบั "ะกะพะฑัะฐัั ะฝะพะฒัั ะบะพัะทะธะฝั" ะดะปั ะฝะพะฒะพะณะพ ะทะฐะฟัะพัะฐ

## ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
vkusvill-mcp-bot/
โโโ app.py                      # ะขะพัะบะฐ ะฒัะพะดะฐ
โโโ config.yaml                 # ะะพะฝัะธะณััะฐัะธั (ะฝะต ะฒ git)
โโโ docker-compose.yml          # Docker ะบะพะฝัะธะณััะฐัะธั
โโโ Dockerfile                  # ะะฑัะฐะท Docker
โโโ requirements.txt            # Python ะทะฐะฒะธัะธะผะพััะธ
โโโ prompts/                    # AI ะฟัะพะผะฟัั (ะผะพะถะฝะพ ัะตะดะฐะบัะธัะพะฒะฐัั)
โ   โโโ system_prompt.txt       # ะกะธััะตะผะฝัะน ะฟัะพะผะฟั
โ   โโโ user_initial_prompt.txt # ะะฐัะฐะปัะฝัะน ะฟัะพะผะฟั
โโโ bot/src/
โ   โโโ handlers/               # Telegram ะพะฑัะฐะฑะพััะธะบะธ
โ   โ   โโโ commands.py         # ะะพะผะฐะฝะดั (/start, /new_chat)
โ   โ   โโโ messages.py         # ะะฑัะฐะฑะพัะบะฐ ัะพะพะฑัะตะฝะธะน
โ   โโโ agent/                  # AI Agent
โ   โ   โโโ runner.py           # ะะฐะฟััะบ ะฐะณะตะฝัะฐ
โ   โโโ mcp/                    # MCP ะบะปะธะตะฝั
โ   โ   โโโ client.py           # HTTP ะบะปะธะตะฝั
โ   โ   โโโ tools.py            # ะะฝััััะผะตะฝัั (search, create_cart)
โ   โโโ utils/
โ       โโโ config.py           # ะะฐะณััะทัะธะบ ะบะพะฝัะธะณััะฐัะธะธ
โ       โโโ logger.py           # ะะพะณะธัะพะฒะฐะฝะธะต ะฒะทะฐะธะผะพะดะตะนััะฒะธะน
โ       โโโ database.py         # ะะฐะทะฐ ะดะฐะฝะฝัั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
โโโ logs/                       # ะะพะณะธ ะฒะทะฐะธะผะพะดะตะนััะฒะธะน (ะฝะต ะฒ git)
โ   โโโ YYYY-MM-DD/
โ       โโโ user_id/
โ           โโโ timestamp.json
โโโ db/                         # ะะฐะทะฐ ะดะฐะฝะฝัั (ะฝะต ะฒ git)
โ   โโโ users.json
โ   โโโ interactions.json
โโโ assets/                     # ะะตััััั
```

## ะะพะทะผะพะถะฝะพััะธ

- ๐ค **AI-ะฐััะธััะตะฝั** ะฝะฐ ะฑะฐะทะต Claude Haiku 4.5
- ๐ **ะะฒัะพะผะฐัะธัะตัะบะธะน ะฟะพะธัะบ** ัะพะฒะฐัะพะฒ ัะตัะตะท MCP
- ๐ **ะะตะฝะตัะฐัะธั ะบะพัะทะธะฝ** ั ะณะพัะพะฒะพะน ัััะปะบะพะน
- โก **ะกััะธะผะธะฝะณ ะพัะฒะตัะพะฒ** ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ (Bot API 9.3)
- ๐ **ะะพะฝัะตะบััะฝะฐั ะฟะฐะผััั** ะฟะพัะปะตะดะฝะธั 20 ัะพะพะฑัะตะฝะธะน
- ๐ฅ **ะฃะฒะตะดะพะผะปะตะฝะธั ะฐะดะผะธะฝะพะฒ** ะพ ะฒัะตั ะทะฐะฟัะพัะฐั
- ๐ **ะะพะณะธัะพะฒะฐะฝะธะต** ะฒัะตั ะฒะทะฐะธะผะพะดะตะนััะฒะธะน ะฒ JSON
- ๐พ **ะะฐะทะฐ ะดะฐะฝะฝัั** ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะธ ััะฐัะธััะธะบะธ

## ะะพะบัะผะตะฝัะฐัะธั

๐ **[ะะพะปะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั ะฒ AGENT.md](AGENT.md)**

## ะะธัะตะฝะทะธั

MIT
